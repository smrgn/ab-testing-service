import streamlit as st
from app.analysis import calculate_sample_size_mean, calculate_sample_size_proportion

# üéØ –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
def render_design_screen():
    st.title("üìê –î–∏–∑–∞–π–Ω A/B-—Ç–µ—Å—Ç–∞")

    st.markdown("–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞, —á—Ç–æ–±—ã —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω—É–∂–Ω—ã–π –æ–±—ä–µ–º –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã")

    # === –®–∞–≥ 1: –£—Ä–æ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –∏ –º–æ—â–Ω–æ—Å—Ç—å ===
    st.markdown("### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞")

    col1, col2 = st.columns(2)
    with col1:
        alpha = st.slider("–£—Ä–æ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ (Œ±)", 0.01, 0.2, 0.05, step=0.01)
    with col2:
        power = st.slider("–ú–æ—â–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ (1 - Œ≤)", 0.5, 0.99, 0.8, step=0.01)

    # st.divider()

    # === –®–∞–≥ 2: –í—ã–±–æ—Ä —Ç–∏–ø–∞ –º–µ—Ç—Ä–∏–∫–∏ ===
    st.markdown("### –í—ã–±–æ—Ä —Ç–∏–ø–∞ –º–µ—Ç—Ä–∏–∫–∏")
    col1, col2 = st.columns(2)
    with col1:
        metric_type = st.radio("–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏", ["–ö–æ–Ω–≤–µ—Ä—Å–∏—è", "–°—Ä–µ–¥–Ω–µ–µ", "–û—Ç–Ω–æ—à–µ–Ω–∏—è (ratio)"])
    with col2:
        compare_count = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π", [1, 2, 3, 4, 5, 6])
        if compare_count >= 3:
            st.warning("üö® –ë—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω–æ –æ—Ç–ª–æ–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç, \
                       —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ!")

    if compare_count >= 2:
        alpha /= compare_count

    # === –®–∞–≥ 4: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —Ä–∞—Å—á—ë—Ç ===
    if metric_type == "–°—Ä–µ–¥–Ω–µ–µ":
        # st.subheader("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç—Ä–∏–∫–∏ —Ç–∏–ø–∞ '–°—Ä–µ–¥–Ω–µ–µ'")
        mean = st.number_input("–ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏", value=100.0)
        std_dev = st.number_input("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ", value=20.0, min_value=0.01)
        mde = st.number_input("–ê–±—Å–æ–ª—é—Ç–Ω—ã–π mde", value=5.0, min_value=0.01)

        if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏"):
            size = calculate_sample_size_mean(std_dev, mde, alpha, power)
            st.success(f"üîπ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –≥—Ä—É–ø–ø—É: **{size} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**")

    elif metric_type == "–ö–æ–Ω–≤–µ—Ä—Å–∏—è":
        # st.subheader("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç—Ä–∏–∫–∏ —Ç–∏–ø–∞ '–ö–æ–Ω–≤–µ—Ä—Å–∏—è'")
        baseline = st.number_input("–ë–∞–∑–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è (%)", value=15.0, max_value=100.0)
        mde = st.number_input("–ê–±—Å–æ–ª—é—Ç–Ω—ã–π MDE (—Ä–∞–∑–Ω–∏—Ü–∞ –≤ %-–ø—É–Ω–∫—Ç–∞—Ö)", value=1.0, min_value=0.01)

        p1 = baseline / 100
        p2 = (baseline + mde) / 100

        if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏"):
            size = calculate_sample_size_proportion(p1, p2, alpha, power)
            st.success(f"üîπ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –≥—Ä—É–ø–ø—É: **{size} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**")

    elif metric_type == "–û—Ç–Ω–æ—à–µ–Ω–∏—è (ratio)":
        # st.subheader("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç—Ä–∏–∫–∏ —Ç–∏–ø–∞ 'Ratio'")
        st.error(f"üö® –ü–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏, –º–µ—Ç—Ä–∏–∫—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ª–∏–Ω–µ–∞—Ä–∏–∑–æ–≤–∞—Ç—å, –∏ —Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è")
        mean_ratio = st.number_input("–ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (ratio)", value=25.0, min_value=0.01)
        std_ratio = st.number_input("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –ª–∏–Ω–µ–∞—Ä–∏–∑–∞—Ü–∏–∏)", value=0.5, min_value=0.01)
        mde = st.number_input("–ê–±—Å–æ–ª—é—Ç–Ω—ã–π mde", value=1.0, min_value=0.01)

        if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏"):
            size = calculate_sample_size_mean(std_ratio, mde, alpha, power)
            st.success(f"üîπ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –≥—Ä—É–ø–ø—É: **{size} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**")